import deap
#import NN
from walker_NN import NNN
from deap import base
from deap import creator
from deap import tools
import math
import gym
import random
from gym import wrappers
import time
import numpy as np
from deap import algorithms
import operator
import pickle

ENV = gym.make("BipedalWalkerHardcore-v2")
MAX_STEPS = 1000
count = 0
creator.create("FitnessMax",base.Fitness,weights=[1.0])
creator.create("Individual", list, fitness=creator.FitnessMax)
nn = NNN()
def get_action(observation,network):
    action = decide_action(observation,network)
    return action

def decide_action(observation,network):
    return nn.conclusion(observation,network)

def rendering(individual):
    global env
    global count
    network = nn.update(individual); #networkにindividualを適用
    total_reward = 0
    observation = ENV.reset()
    action_lists = []
    total_novelty = 0
    for i in range(MAX_STEPS):
        #ENV = wrappers.Monitor(env,'/mnt/c/Users/bc/Documents/EA/BipedalWalker/noveltymovies/',force=True)
        action = get_action(observation,network)
        observation,reward,done,xylists = ENV.step(action)
        ENV.render()
        action_lists.append(xylists)
        total_reward += reward
        if done:
            ENV.render()
            break
    for i in range(len(action_lists) - 1):
            total_novelty += np.sqrt((action_lists[i+1][0] - action_lists[i][0])**2 + (action_lists[i+1][1] - action_lists[i][1])**2)
    print(count,":",total_novelty)
    count+=1
def main():
    '''
    with open('gen150checkpoint_maxstepsliner', 'rb') as f:
        population = pickle.load(f)
    '''
    """
    with open('gen1000hof','rb') as f:
        ind = pickle.load(f)
    print(fp)
    """
    ind = [-0.85558979441981231, 0.065414042025189606, -1.3678906450186992, -1.5926897505691251, 0.71425404377963631, 1.1718463147386522, -0.78211525288457007, -0.65712711557516257, -1.0501439866565683, -2.835926231956349, -0.36187510862747618, -0.32974977992181065, -0.88352107060783691, 0.82821655506723557, -0.15671586399967047, 2.8339889789065751, 0.64739934856554326, 0.20330363752542896, -1.1248603761837275, -0.5266835052990213, -0.15450039346103839, -0.27961490888583701, -0.83876592345430123, 0.55249672417241769, -3.0693246029200778, 0.11253129507723936, 1.2740993415028017, -2.068288915226641, -1.1226571588082357, -0.17902914676090476, 1.0349641457443126, 1.5041384618021869, 0.98176668043815685, -1.4439422548520335, -1.5501842372127104, 0.32373962993705746, 1.1213007428092201, -0.18885358069598154, -0.48131475526968681, -0.2120037629163648, 2.0954035080871147, -2.043951532139062, -0.71807840347982566, -1.9016018504124304, 0.986978448281426, -0.51891236262512452, 0.92757734661551261, -0.44267161696394275, 0.33742451252073768, 0.44629147538344843, 1.9700013903111753, -0.70179619231978707, -1.094763934740103, -0.30550910396328579, 0.053475023572484778, -0.52098877679189526, -2.3834373335427381, -0.11028260419012391, -1.8830244346815714, 0.1274654155942081, 0.31073666050164905, 1.3024924397202093, -0.88766685605176332, -1.274127818316624, -0.91139055484256248, -0.9520643749572143, 0.31406945023357857, 0.085362212297644346, -0.039449787984390805, 1.3899987807184078, -1.0274660603950203, -1.9301891268345746, 0.50869451289242018, 1.0525424431760784, -0.44545517378739208, -1.633774633967735, 0.15182658019087819, 0.18698583225769427, 0.076881840830459888, 0.023255625182852901, 1.957716198822895, -0.037451680464289885, -0.0070299498624254476, -0.94220000798454528, -0.32150449558678362, 0.16631768015716708, 0.45722728804784424, -0.7641337159762509, 0.43380784903996994, -0.49335354916442797, -0.61040353700981709, 0.78118359569625451, 0.89171479460643366, 1.0469497911777905, -0.58016756529438163, -0.9486832695946561, 0.66997910060181276, -1.7601293387160317, 0.72287643015174086, 0.98860569128846798, 0.23078706305827723, -0.019028785366864524, -1.4337950324398518, -0.39179024706955212, 0.048463934591930102, 0.84817710163467408, -0.40528258799634342, 0.66952230917783262, 1.1762714963259944, -0.78965223697420783, 3.4304727388799057, 2.5401268323507704, 0.41973862307281523, -1.1703489190694558, 0.56820416018553488, -0.68372441858312061, 1.6930034887517764, -0.15824104449400495, 0.67675095925488415, -0.47768333872925761, -0.57259563054605622, -0.35367308870331049, 0.39605377401235026, -1.7497570509847329, -1.1778632237287787, -0.67900030499230835, 1.9324294804783493, 0.10458694663043924, -0.56469639934192906, 0.13269771516516615, -0.10086518889857406, -0.63756643982141781, 0.85305027957910706, 0.24605245516168212, -0.91293093559422867, -0.95200899478036005, 0.92340653571412945, -0.36284313631930265, 0.7760605693980327, 1.622240914220185, -0.66691419980484523, 0.73985246858931386, 0.42620088946923268, 1.0439159113757146, -0.16444578333933851, -1.4237914276303112, 1.572267463643076, -0.53503878314649911, -1.3540007594536161, -3.0585480004830488, -0.78935935056971207, -0.4513292052487064, -2.6720795524378742, 0.61114649107041907, -0.70082088160574751, 0.24346158925857234, 0.84851910561481025, 0.41389802461682274, -1.4949549893595422, 0.91140547322852405, 0.021623965793563543, 0.68564383149986774, -1.2638465508505705, -2.0590412109555416, -0.71936535699541748, -0.49557115537997937, 2.2411116844496881, 0.53137300079353345, 0.37808816300467152, -1.7245438652462237, 0.75887195915879635, -0.30958129698795223, 0.70988596444862928, -0.85223287138480197, 0.20213720300065535, 0.57720024464534647, -1.3507977865136946, 1.4735766635648921, -0.48949712462567363, -1.1119948052090796, -1.264842006123819, -0.33967892197645566, -0.84620799360054422, -0.20840403702076593, 0.1415558305939244, -0.70531441224434399, -0.91980954551528038, -0.78271258148579892, -0.40087908452616361, 0.30649489375320488, 0.34436329831307388, -0.088200055861294452, 0.59813110024981964, 0.281754743409386, -0.46757332701035403, -0.30307325459944257, -1.0084265380472597, 1.4898715893095476, 0.20103722944668612, 0.59755607588839244, 0.95988542322326431, 2.0950840798819388, -0.29066793146305014, 0.35538755386480902, -0.96544923322692755, -2.555383505228745, 0.14536430603103623, 1.361110763510192, 1.5247358875041053, -1.1844206733233844, 0.46478732006380186, 0.46978689159295905, -1.1501071282913442, 1.0618475336163171, -0.52238811807638597, -0.93460095930466014, 0.12698929242983595, -0.28642198318872336, -0.73744337684590533, -0.92046698657939352, -0.78400261579998332, 1.2353243737275641, -3.6605705268063118, -0.37634126633010362, -1.7313331030805768, 0.80788242039726521, -0.63322856188710663, -0.61245058909445982, 1.178719470844019, -0.63283841566189558, -0.66604924823990164, 0.72535194632188338, 0.35920349007365693, -0.91657915982651761, 0.97062309421404591, 0.6878928484238398, 2.0390815277013665, 0.68648881588172261, -0.21622378819492838, 1.3338536592056278, 0.26397945497444519, -2.1923971283893873, -1.47634743363997, -1.5035869616523363, -0.51921401417172564, -1.6577524085221844, 0.087146362160929081, 0.61668085169554387, -0.37599377199478695, 2.122318957729076, -0.38688992973323194, -0.88897170170379236, 0.097908062589657119, 0.53435985052195223, 0.21865704095693389, -0.22378081124289384, 0.83654387540447939, -0.15584052525894268, 0.53525406536931408, 2.6697357182119328, -1.5579495792189335, 0.54557567464063683, 1.8740146868674949, -0.7366264822862465, 1.594713540423722, -0.48962095211993778, 0.8523482435711669, -0.81542250689663121, -0.15333155904188087, -0.68865332356359166, 0.96459913468231351, -0.63909459364297116, -0.78804282705937734, 1.3687086304926672, 0.55979792870455169, 0.96342201498062219, -0.85470174810772892, -1.2943194346641498, 1.7069351706771438, -1.0816082416189863, 0.43700109810299848, -1.0848938734653766, 0.089857879511391459, 0.95387111920103473, -0.66504807911691222, -0.8061692442651569, 1.4481770714763798, -0.22674793990399256, -0.0814496528195882, -0.82982233706344188, 0.032365813282768684, 1.4078084120165979, 0.32663926096118223, 1.6511900317384778, 0.1781647120992283, 1.0195571735169766, 2.3098318927778201, 2.3118887851965271, -0.82914861970605491, 0.13302656905027452, -0.45490302287512646, -2.3305061341487612, 0.63344974913462504, -1.6507424852906325, -0.50830738728303815, 1.0467041062955964, -0.15460029537895231, 0.65302260638226528, 0.35263420529543277, 0.18044492609240065, 3.3360131490458071, -0.89457180842577877, -0.52715726409627117, -0.1658054337407095, -2.1991821155562725, 0.60061341676205038, 1.4384819793372299, -1.2336016352670192, -0.3796004038467572, 0.44530522501955505, -2.1974453411280193, -0.86920696503160566, -1.1592601363889321, -0.06660747253113794, 1.6378682959869366, -1.9918434902142956, -0.029041378437500986, 0.53320478125556348, 0.61247084820041886, 2.5263471228116936, 1.1634740142281874, 0.25194085055602577, 2.5476440130198945, 0.63219452566027434, -0.57478369356648495, -0.31583457423467987, 1.6081393685017682, -0.57150941053646731, -0.92826859379029569, -0.64347308323031083, 1.7654940141524798, -0.92127770268295572, -0.85158687625849683, -0.94639333195326869, 0.18052407746045321, -0.91005630684367778, -1.7530816659454387, -1.8421986164872957, -0.28694192696871013, -0.73992050589417968, -0.72464460447622658, -1.8242449136148304, -0.065721878001278655, -0.17050968122128146, 0.010058074627346814, -0.0025487664835097956, -0.24738940772536469, -1.3924378517168206, -0.16690085437360452, -0.56645812241864468, 0.3122422428556404, 0.17052953206604182, -1.4602800486393936, 1.8903224324251702, 0.18883046208415719, -1.4188401570089022, 1.8873726591180495, -1.0977438657966085, 0.16835861134555541, -2.6264335699738379, 0.47518595421573989, -0.18648347465447496, 0.9282771256825314, -0.054549882571684805, 0.92109405994143911, -0.12596853276243458, 2.1695190191219802, 0.91334175622615721, -0.48283622145028671, 0.1308082957082338, 0.63212689863388227, -0.83707939761381511, -0.5465269687725427, -0.16619558889361466, 0.75575686089272254, -1.8209573589516537, 0.32238343682489057, 0.33099230421306503, 0.88482872399129353, -1.1005033873999448, 1.0081679546845488, -0.44395105228879461, 0.34600010495947819, -0.1139047228111629, 0.11642268127644814, 1.0451120686991566, 0.059783433591820687, -0.43777832785435078, 0.49665635410814291, 0.2842986057325938, 1.2210998573005793, -0.33800624415706054, 1.2386421025011844, -1.4455965506674109, -1.0840631053565022, 0.039239733268604582, 0.66487639341914428, 1.4164475258884417, 0.084198076548473277, -0.37118514491647309, -1.2992750352379052, -0.12656163626110295, -0.94887298437734524, 0.70591797317941452, -1.7613891218628428, 1.064892073593215, -0.51804285030382302, -0.59020074161694558, -0.018250300042440739, 1.2958091247441008, -3.3470803298798755, -1.1365382539053051, 0.12562292272248715, 0.40650929037706479, -0.2111378533081083, 0.69203079826553271, -1.73254911950668, 0.77750451489175032, -0.65102378540077366, 1.1455799135035856, -1.3716560776532127, -0.70050457513064612, 3.2975397419077321, 0.073448031078860776, -0.17304953675652307, -0.65242008162586695, 0.55847772886387859, 0.95961885574829009, 1.0226512881343028, 0.9401435413299648, -0.68694954428210031, 0.95680819690354646, -0.42171095120070834, 0.10181054690695726, -0.21258136800912464, 0.78824536189983951, 0.83768126640039298, -0.80357862745496811, 1.0529238733887707, -1.4324874085754047, 1.5339360179987427, 1.6073310653642652, 0.14140781215355813, 0.39578950829104614, 0.95052685154146255, -0.87195756064930952, -1.1113749470969569, 0.24413058325841525, -1.4948855488370842, -0.56664167722282466, -0.15931524764701793, -0.83020356128554074, 0.87365103503750918, -0.36522716352680362, -1.9248689734001916, -0.35982250238848468, -1.0819038915146253, -1.973221605337997, 0.12464485771051285, 0.81903873264552596, -0.61074088024102835, -1.6294449876450292, -0.88089657822092171, -1.2973529059218345, 1.119197540333009, 0.44760158921878013, 0.066164878872614241, 0.65489537533655184, 0.50593035153247978, 1.4455468033388332, -0.14793175539812611, -0.68207112072124909, -0.60600823381493085, 0.68344780197924937, 0.08999417359091802, -1.2737570027976175, 0.93770165684201467, -1.0047353217045631, 0.8137692944251359, 1.21104441173123, 1.1974035649499835, 3.6680087588321708, -0.37220087476421931, 0.99170802146743342, -0.58869140787191654, -1.1846787098157936, -0.16031479375624846, 0.33980306488963102, 0.20241910845539315, -0.19395917230210988, 0.58735300813001601, -1.3922277034495416, -1.0234848167956423, -0.96039084561235155, -1.3727888269197903, -1.4966021205857865, -1.2146477511205866, 0.96210267865729304, 1.4545020707691394, -0.89977449593904324, 1.557841878738158, -0.68463585966726992, -0.7876483469044957, -0.16079925702196618, 1.1165647571185047, 0.42631828966651808, 2.5665721721338328, -1.8116216522461137, 1.131781814805372, -2.2371629675298315, 1.3957961170981672, -0.45476272915296578, 1.2219876301686072, 0.23954146898033762, 1.215476915351791, 1.419423676604378, 0.76165809592782197, -0.72496669798201996, -0.1824924522697644, -2.459921387721109, -0.13356535111298845, 0.97300644011052562, -0.46930397226086312, 0.50021523814839675, -0.78583802372977796, 0.68657730702662811, 2.5137214535715584, 1.1099358785280837, 0.90921614458105438, 0.37185967301620282, 0.95510619149239362, -0.8759879457317068, -0.11396878557436699, -0.13927197503395386, -0.33327849342802285, 2.0237020929423593, -0.23030882560798557, 1.3642617046496397, -1.0176431987669701, 0.56708528838653316, -0.68543924983743065, 0.40994215854201072, -1.0556140347053034, 0.15766173959001484, 0.8139983326973893, 1.0058212232366213, -0.10393949047682093, -0.016349517073808162, -1.2691331891758666, -0.73765500456976008, -0.5896669365460947, 1.6330110973258898, 0.95731829494939469, 0.82092562109393374, 0.46427991476064007, 1.3071525839263545, 1.4380901660067953, 0.36401246009375066, 1.1266611279559269, 0.22475541961717146, -0.3072868292804638, 0.3933694934820815] 
    for _ in range(10):
        rendering(ind)
    for ind in population:
        rendering(ind)
if __name__=='__main__':
    main()
