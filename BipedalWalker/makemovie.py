import deap
#import NN
from walker_NN import NNN
from deap import base
from deap import creator
from deap import tools
import math
import gym
import random
from gym import wrappers
import time
import numpy as np
from deap import algorithms
import operator
import pickle

env = gym.make("BipedalWalkerHardcore-v2")
ENV = wrappers.Monitor(env,'/mnt/c/Users/bc/Documents/EA/BipedalWalker/movies/',force=True)
MAX_STEPS = 5000
count = 0
creator.create("FitnessMax",base.Fitness,weights=[1.0])
creator.create("Individual", list, fitness=creator.FitnessMax)
nn = NNN()
def get_action(observation,network):
    action = decide_action(observation,network)
    return action

def decide_action(observation,network):
    return nn.conclusion(observation,network)

def rendering(individual):
    global env
    global count
    network = nn.update(individual); #networkにindividualを適用
    total_reward = 0
    observation = ENV.reset()
    for i in range(MAX_STEPS):
        action = get_action(observation,network)
        observation,reward,done,xylists = ENV.step(action)
        #print("action:",action,"xylists:",xylists)
        ENV.render()
        total_reward += reward
        if done:
            print(i)
            ENV.render()
            break
    print(count,":",total_reward)
    count+=1
def main():
    with open('gen50checkpoint_fitness_hardcore', 'rb') as f:
        population = pickle.load(f)
    ind = [-0.85741756277189107, -0.82972545904182915, 1.7170533909009744, -0.82179992589590034, -0.18376855283142124, -0.65852140658492186, 1.2836120128262185, -0.7643267979236863, -1.1525754171059177, 0.74005381289576766, -0.77652879341701408, 0.77492049340477687, -2.0965265236521331, 0.8054913221375366, 1.3234293555654304, 0.74975599146762262, -1.0269402412550113, 0.719923481620654, -0.076196946728791071, -1.8641721399359192, 0.84578122650553278, -0.73586062214077996, 0.45077165338652159, -1.710495936513154, -0.24848059027762034, 1.2569254025670831, 1.81301138057121, -0.05092164961436367, 1.0569477269222363, -0.56025808914891595, 0.49926776624891728, 1.4322392272079649, 0.68585805266681854, -0.6665933461710043, 2.3860884899119572, -1.3573599100954876, 0.32249644610421196, 0.87230565025763274, -1.6047911893083668, 0.97457351363473754, 3.7353259349452279, 0.92078223377771162, 0.29372793342374381, -1.1542364995729395, 0.96472883258548614, -0.014298540617551973, 1.1065876528852487, -0.61138242613687099, 0.098837542203768475, -3.0252866209218197, 1.1980262825551744, -0.18005950634053308, -0.73750215912588812, 0.31562456316000326, -1.4687815970018487, -1.0545889842326519, 0.78292099781271318, 0.11516978176628116, -0.67673937366081249, -1.0647749061499034, -0.19584760597339013, 0.68473529621679285, -3.9663610356150194, 1.252189971500433, 0.2496490902961585, -2.4906801335104731, 0.92417515981625242, -0.64097917973444951, 1.1104890888311232, 0.30587074329044528, -2.4239244237783968, -0.98385513855237683, 1.8131830441446692, 0.22599286140086006, -0.51118863803288717, -0.87586844452096135, 4.3334926942982541, -0.82993932637798307, 1.362951117431968, -0.76568539099925714, 2.0363591628648692, -0.90137354843302275, -0.8055758091278864, -0.29772350088699306, -1.2282275732154575, 0.45627475997129607, 0.84313465733502868, -1.6605835997196439, -0.59952640575062466, -1.6500736268048328, 0.2506743635772759, 2.4463534202499684, -0.48285740178584013, 0.25395513959690919, -0.29108682820821408, 1.7561017819972937, -0.7694555326985647, -0.71235918837474432, -0.81817125905452248, 0.7574038941800294, -1.6726949517382881, 1.5307117925716329, -2.7741186840091099, -0.66327355746596539, 0.34029341011442404, -2.5361612139027279, -1.2572773807665159, -1.7867901537616726, -0.55733563518230689, 0.048635303160930024, -0.68920999052513077, -3.0525034775524458, -0.85151083785737014, -2.171614586817836, -0.29864863085002535, -0.85930425578996139, -0.45506385024862295, 0.54014271770500022, 1.1082975896601015, -0.28752971789424964, -0.76810950043339821, -1.1635247264021031, -1.7410958322349672, -0.092245408491794273, -1.0655562219511303, 0.12896418386335923, 3.2106187805055315, 1.9481572825653475, 0.14551324092936235, 0.061279210291576236, 0.49172918541752014, -0.67623846421340428, -0.79891250987091822, -0.82343118832460682, -0.49940555257781694, -0.68196515510408329, 0.56749930383769964, -1.2437295189539377, 0.11875190590576207, 0.33304980874831858, 0.032428719653540619, 1.0420907184523702, -0.33621499823654188, 0.37260087153662763, 0.51526935405651264, -1.442632749041721, -1.3989334374969462, 0.27540342418613362, -2.2620570535959335, -0.1181699114514739, -0.56710789029505793, 0.55729850660971292, -1.5308540230356029, 1.1416238480305685, -0.16965328906749633, -0.88272385362354422, 2.9441893518430913, -2.503242518975374, -0.27811061077126775, 0.52435820756767559, -0.059566292262085874, 4.2133502241837633, -2.1368447502205292, -0.37131203183995409, 0.007587596732715484, -1.0249503021984827, -1.3836392675009526, -0.059902602577945038, 0.41856167146155199, 0.041329865638925198, 0.91085591679760647, 3.4538583451964922, -1.8869480856697665, -0.0026678854707492261, -0.74122007491805919, 0.89641674490163636, -0.79001966902143383, -0.13652003902665233, -0.1835625127775915, -0.064011112980387752, -0.80238491555752356, 2.2981926544666438, -1.1590598087096549, 1.3497823729833711, 0.29868738541283046, -1.2555397042157386, -0.14822400635039018, 1.6428619265568378, 1.0141094601221261, 1.8407907009677422, 0.55241565372786461, -0.020228659155372211, 1.6707365673612737, 0.46344143114193359, -0.026564969003249748, -2.0387094814695352, -3.4191141812006345, -0.096184863982416602, -1.0327627190621662, -0.83069214852216167, 0.70411613532226092, -0.46587438064529474, -2.6654603188182504, -0.79790772039168278, -0.039977198989796681, -1.1164988001474261, -1.2223656828805778, 0.25683868693338885, -0.46574433785386732, -0.28930459263469027, -0.96287854561762143, 1.1512323676810077, 1.135378162358752, 0.76992933690051635, -0.13867731638044578, 0.90364231458460531, -0.45500670390371445, -0.079899316919441341, 0.27899370328724549, 0.41187671617995936, 0.94526704234229308, 0.4654541154257944, -1.2737229547696867, 2.9421929751903706, 0.30642401383542994, 1.0629624622112499, 0.56525005877505108, 1.8875936224333598, 0.086150011688438111, 0.91632040577343887, 0.11523543175029491, -0.61673629182992329, -0.18660543017276543, -0.62510796159884285, -0.24833814193728218, -1.5042783960070469, 1.0142652708779925, 0.82776413134542559, 0.73729970384384524, -2.5510316275404548, -0.27192549896517287, -1.3782895574826299, 0.89160260891128673, 2.1658205080536517, -1.4987881180289602, 1.7610691882378311, 0.064986878951401594, -3.3126218475478013, 0.95882449632945321, 0.001828029919468387, 0.64031843028016966, 0.59109662544617958, -0.81021195150308478, -1.7311186845385969, 2.5239552061370634, -0.64392625500054734, 1.0036808028826212, -1.8330825504924975, -0.25220906619932792, 0.3146257642522251, 2.6437097092688813, -0.26825925712938098, -0.38983537799497736, -0.18866328779975305, 1.3503335930785036, 0.85640634193087162, 0.26993501592628433, 0.9731093874229082, -2.0434455893051142, 0.12088984132078555, 2.4585370995067386, -2.0965326437343572, 1.0892190617737842, -0.12432648039956354, -0.2383653925063825, -3.4890144040446245, 1.1485540437514543, 0.18269515531079644, 2.6110978660261797, 1.0430639976073803, -0.49912937468400354, 0.73403085819427827, 1.6785340137758578, 0.35991992425183406, -1.3254400192442974, -1.8448866831044555, 0.54923270746658592, -1.5826411795340551, 0.040873355650246607, -2.1991076762980382, -0.29432702934971267, -1.05269957080362, 0.74193454352525134, 0.80521250694433344, 1.8094921575330474, 2.2137028277497253, 0.38658500700887644, -0.85384157766976498, 0.12783756887584219, -0.47314262331701851, -0.67737621947258886, -0.21730182021248917, 0.94053223100726957, -0.70164662421364055, -0.59571395899247404, -0.45639230350534365, 1.6067773574843676, -0.02394949027899651, -0.10028586547195319, 0.49888957081331003, -0.60715035618576929, -0.61646999659579227, 0.35976972967632498, -1.5566981770629296, 1.3389079809081745, -1.640304354595489, 0.40373280090686087, -0.44334308170618375, -0.62939434358204926, -0.69748644499315171, -0.69670323490845343, -0.98707870727631875, -0.60803345893555827, -2.6482089650936382, -0.47178028244955095, 0.080984946493952104, 1.0567343126129978, 2.1106767627151859, -1.0369734624573534, -1.0967977639358475, -3.9946741151763092, 0.22068386701103679, 0.7697120822450727, -1.5972082328443167, -0.34502828694882526, -0.078807339583012614, 0.38737151076663578, -1.7195840722491953, -1.7746525382079672, 1.7907609712676333, -1.8902497348417295, -0.34340619163022501, 0.57484312443238694, 0.36749742359859228, -0.73706199993508514, -0.6487665017128994, 1.9987055297431096, -0.29241379290448621, 0.99433672370063009, 0.40035868446377365, -2.0584080840375165, -1.3108905445493688, 1.063231382681332, 0.0020369536250924832, -0.55011109709893091, -1.8385717842033813, -2.1405376982679742, 0.51258770555210686, 0.48483499019379583, -1.4343036573343046, -1.0918444930981019, -0.46546185401162204, -1.1488341152447359, 0.5439730743823088, 1.2504762542904406, -0.77240427005968204, -0.17044524572652686, 0.23181732479950964, 1.0309338726111248, 1.589420439019841, 1.4142663802584168, 0.29382935638491242, 0.48762490810883219, -0.39545948609475201, -1.0487404627186807, 0.083603563438857414, -1.8071338653043179, 0.59599659830939311, 1.2869480224787426, 0.99097813639538901, 0.76337881865922985, 1.623337383811214, -0.15712688852953788, -0.42546522233617601, 0.46689290859316956, -0.29281046594218096, -1.1816417503599848, 0.2103936405830415, -0.097388649390547033, 0.20294611761540576, -3.0929055140728536, -0.33429479611990687, -3.5923539342625399, -1.4266867832487513, -0.1849950140891615, 3.7951151591749079, -0.26106664176853356, 0.37189260067842572, -0.59962009358986423, 0.83519446796982888, -0.75705121722891855, -0.21208128841394369, 0.55790108788459558, -0.24988182549069743, 0.68458221231744487, 1.0623601135703551, 1.4518586592620659, 0.39481967928141509, -0.14105038051723051, -0.43958446159760489, 0.31737997435624932, -0.90480040819198904, -0.966645501996104, 1.2260515443860864, 0.2631513780774456, 0.82355474387555649, -2.1994908854026249, 1.2905740482562571, -2.2129111263128731, -1.027223028490625, 0.3390371652975458, -2.6075436872366566, -0.019988928507519488, 0.19092979955900688, -0.87284808594031738, 0.39878889036780352, -0.79557030392623762, -0.99423453939586448, 1.2590646496100866, 0.59431059343988157, -0.68528665653253684, -0.10744053990716226, -2.4602454639786764, -2.2036992595832352, -0.17676267834635034, -0.45127595131387088, 0.97717155305169556, -1.7964803987424671, 0.075667415004034649, -0.07265489807478262, -0.76947406388252904, 0.81358611987807627, 0.0019435732222212905, -2.1641353636895051, 0.28297806725852093, 0.61869037777441682, -0.41479849800019164, -0.63359218552864349, 2.0578290849391543, -0.327546096741552, 1.2356774761528304, -0.60102132404966024, -1.323011604093427, 0.36777781641445773, 0.18754197576489509, 0.26398005171129746, 0.82126288170778217, -1.4877366454472898, -0.40747555788662182, -1.881169812847338, 0.285148515589982, -2.0229231100493497, -0.47068922482085174, -1.1333666097122697, -0.56251054152232516, -0.39540775603754563, -1.5365746688872461, 0.59964372794763321, -0.13901428681143535, 1.1851580137738118, -1.1376008230945303, 0.2973979592959558, 1.1594260389916107, -2.8162731563656593, -2.9898309679506672, 0.65301979387524534, -0.54477172440025123, 1.1624354947326681, -0.21150404466779155, 0.88494382404144134, 0.23881808447392633, 0.19432795902189262, -1.2635413224880971, -2.0758874337958897, -0.7530854071037637, -2.0516043076095469, -0.39368149165105237, 1.4917979761354363, 0.93292523235103375, -0.84617132669826733, 1.4322569789942314, 1.7724894959320197, -0.70620000467366051, 0.75420046105859018, 0.14304700320638286, -0.49178506373473574, 6.8996397300991212, 0.30316908232132289, -1.882337493539382, 0.17623006954407311, 2.0395306789524641, -0.56391334451942821, -0.80596640895158123, -0.25105287295505069, -1.5467594986464948, -0.60190935383533284, 0.39714178876174344, -0.69012033123625427, 1.8685764915221257, -0.32912900552458868, 0.30692678996766642, -0.65996472872451006, 0.26785219776173691, -2.5990655731678007, 1.9734586855970204, 0.39347123446828092, 1.5976139864377461, 1.2755797921962571, 0.36848442465332254, -2.156441277134606, 0.53426584541004551, -2.2248974605284979, -0.3128063168950897, -0.38371804667316839, -0.012568894975432635, -0.49751044152709156, -0.31375491558039403, 0.69155241173120885, -0.19484228007562759, 2.518148840981699, 0.92884692992727191, 0.40232821728968271, 1.3824457623220709, -0.52565169937200296, -0.45315762669127158, -0.25506705287237119, 0.72890570993013437, -0.71081846991151831, -1.3472583452402314, 0.040564127810904668, 0.55417002404178084, -0.30979150993391624, 0.30038195163396175, 0.3738764243463355, -1.1490433294170983, 0.88238787050663603, 0.12411894165274386, -1.4082543443234647, 0.075255916553426422, -1.4463028853007744, 1.4365461012477283, 0.60248308727206568, -0.14328408906473461, 0.20738260405232284, 1.2363988200428109, 1.0823637463542317, 1.2241562434968118, 0.079202670636449535, 0.52240291233688751, -0.42130505396548934, 0.3609552006565091, -0.11129340922322858, -0.11064015440235625, -0.32765174033770639, 2.4429530639371362, -2.4980121713967627, -0.73440400242042858, 0.12286156995387632, 0.48888660623727065, -1.0975549953619095, 1.1276672562038224, -0.53172797594182764]
    for _ in range(2):
        rendering(ind)
    for ind in population:
        rendering(ind)
if __name__=='__main__':
    main()
