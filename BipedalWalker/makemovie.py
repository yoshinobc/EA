import deap
#import NN
from walker_NN import NNN
from deap import base
from deap import creator
from deap import tools
import math
import gym
import random
from gym import wrappers
import time
import numpy as np
from deap import algorithms
import operator
import pickle

ENV = gym.make("BipedalWalker-v2")
MAX_STEPS = 5000
count = 0
creator.create("FitnessMax",base.Fitness,weights=[1.0])
creator.create("Individual", list, fitness=creator.FitnessMax)
nn = NNN()
def get_action(observation,network):
    action = decide_action(observation,network)
    return action

def decide_action(observation,network):
    return nn.conclusion(observation,network)

def rendering(individual):
    global env
    global count
    network = nn.update(individual); #networkにindividualを適用
    total_reward = 0
    observation = ENV.reset()
    for i in range(MAX_STEPS):
        #ENV = wrappers.Monitor(env,'/mnt/c/Users/bc/Documents/EA/BipedalWalker/noveltymovies/',force=True)
        
        action = get_action(observation,network)
        observation,reward,done,xylists = ENV.step(action)
        #print("action:",action,"xylists:",xylists)
        ENV.render()
        total_reward += reward
        if done:
            print(i)
            ENV.render()
            break
    print(count,":",total_reward)
    count+=1
def main():
    with open('gen50checkpoint_fitness_hardcore', 'rb') as f:
        population = pickle.load(f)
    ind = [-0.61799741584547752, -0.75139219284303016, -0.23780030778985212, 0.25862879318607485, -2.4426105674690284, -1.4758161190453309, -1.3171401258240216, -0.53733218779676151, -0.31308669198297723, 0.98565404279790392, -0.43183480594311058, -0.046543889151546454, -1.7055542806496948, 0.091613508382285019, -0.18266768864197225, -0.93034331776164159, -1.2786170513612269, -0.48342110785525105, -0.20215166536986365, -0.14350814481551677, 0.092460014841075633, 2.1113411184088617, 2.1338057594990163, 1.5221194711936736, 0.058919255565906679, 1.1161926607837618, -0.50357928479300562, 0.46230412868217813, 0.93577154748681735, 0.25831131202945767, 1.0282074867524946, 0.87295542165593953, -0.39054027609445563, -0.024036165308819218, -0.42686835592699085, -0.97631632619288633, 1.1546237370797459, -0.96147624258118991, -2.2154218469099609, 1.2283896944738038, 0.79148415209136969, -0.092346647278750749, -1.1692782923734877, -1.5506956451398013, 0.62592282843569402, -0.027415902792653567, -2.2537273286749056, 1.7688397219340373, -2.6552191132565159, -0.34841948080264967, 0.68642680885585439, 0.3777167801944209, -1.132459633297128, -1.3288716565460226, -0.47417504713752845, -0.80737287712218719, 0.35033057356532155, 1.3658614923559456, 0.58661293650635171, -0.25587325996174581, 2.374325641907022, 0.67629546085761139, 0.61030030147823977, 2.653464082096141, 1.8184444793002319, -0.67017409330429112, -0.16601607244214001, 0.69322977957837839, 0.033294950111997942, 0.82712769505458406, 1.5178497346830211, -1.8179376227892101, 0.35816761998255497, -0.85124374904593825, 1.0747814527290882, 1.7803299622800142, 1.0782310323868696, -0.65811533729412486, -0.89786445692178696, -3.0861406583200415, 1.0985248386299669, 1.2938969070375692, 1.0055980545492476, -1.0854072185552306, 1.111070957625816, -0.73758082774283673, -2.0673683812910832, 1.080482076214283, 0.20415458635827383, -0.71077424767571218, 0.46525434750540351, -0.25963622274138992, -0.73941900875957545, 0.45213638261745481, 1.4491003592580856, 0.85318203746198817, -0.30137704079415689, 0.37005171815057925, 0.42953141961539715, -2.3292829125868377, -0.5779808319700005, 0.98967649444222217, 0.013417844789569141, -0.41807446337446297, 1.0890502113817486, -0.31834051958436665, 0.52439940228222914, -0.92848320979347532, 1.7889125520905886, 1.4910037401120686, 1.1419393540242597, 0.64365332877247894, -2.5107051493879915, -0.087162671483281759, -1.4617520172212646, 0.38721996632261513, 0.32961555138322846, -0.0169429610378414, 1.1002636511540813, 1.793607882735953, -0.72904532665728827, -1.0759248019536924, -0.40008361861710812, 1.417464585325195, -0.32429855146915171, 0.73806226173495271, -0.04785842969820199, 1.3802368498697222, 1.0331309258265815, 0.2904516764958423, -0.2477757236196885, -0.95570788863058298, -1.0956183495102259, 0.5563759124388945, 0.14936731968054348, 1.7684068366699499, 1.7675216050010576, -1.397434924175005, -1.1757350991037154, 1.5150598367527617, 0.95955765015940864, -1.3635575967145142, 0.12123838359207238, -0.13879373624888477, 0.10072054931993023, -0.16973719038442159, -0.42321119284100317, -0.37617804778089414, -0.96584686416782961, -0.87277901223993648, -0.071974738553311365, 1.1200565251976151, -1.7397625626864064, 0.99250373178376639, -0.43750382595660398, -0.086225224775830278, 0.05588821420496011, -1.0334173100351296, -2.0694306980224635, -0.10109756140142262, 0.93996894900266625, 1.3441619238541227, -2.0761067508707978, 0.61295898589377618, -0.27827594857230631, -0.046618617707676238, -0.68019357482203824, -2.7257413573891762, -0.2625393059040857, 0.18151734721084684, 2.4044530674491478, -0.32925305357585272, -0.060965484923836383, 0.4237948593082756, -0.11663532393517582, 1.5125772152271908, 1.2696476116994879, 0.091220109121245757, -0.19701180513366817, 0.16357011076867442, -0.8250742263610128, -0.22692251577078715, -0.33622977467151849, -0.12798263819235933, 3.480333647682269, 1.4304213874424987, 0.67389370714653518, -0.8081504074363961, 0.59959645323006294, 1.7745203298123946, -0.87900284190610756, -0.63925571028426154, 0.49979316102803523, 1.442354556405691, 2.0080448180373978, 1.641605009684012, -0.15217719943815006, 1.0974212529992491, -2.626810553540929, 1.5704912346927427, 0.033088409303654462, 0.13914135734268224, -1.0675520924740065, -0.88848826296113192, 1.0690527457112449, 0.6166744584359104, 0.18336949793560225, -0.92661799145932466, -2.1193563129413797, 0.43979121717953601, -0.35166170691432119, 0.83791658930130186, -0.45303375413278918, 0.06907341998700367, -0.86079427103789941, -1.9618905456538389, -0.45936970689599033, 0.014969086507793647, 2.0120687377907793, 0.092620642467559466, -0.55139736966238562, 0.22387263820675785, -0.50856556587443502, -1.3387430858552931, -1.5321186249391217, -1.2408933387775845, -0.90437862696048965, 0.38035727221118354, 1.6825593394254572, -0.12937199148140882, -1.9584745054523012, 0.54437578772299977, 0.44450296544998896, -0.12367817398773183, -0.20349993114356016, 0.59546355918964944, -0.92384288618851595, -0.76376548025991919, -1.4192251052269542, 1.0717100821967498, 0.13975737957709089, 1.1638655159496105, 0.46130421939650085, -0.83164917427558049, 2.0515450002615245, 3.237655608266695, -0.10390972044829573, -1.1541646526557419, 1.3772971896547987, -1.8895933087598693, 0.98373475399436505, -0.062996476255500075, -0.9300491373763542, 0.1104353278026329, 0.036363554494462727, 0.23005179268168807, 0.94427371869898746, -0.13050344964903185, -1.4443863197135471, -0.63169617580612702, 0.22558502759342813, 0.51446631659623987, -0.12386491612350074, 0.13915868320934735, -0.077187428805965796, -0.047859813755620643, 0.1628425670370775, -0.38305001607747491, -3.1257991818952267, -0.91393165308047686, -1.3566160872017037, 0.25022828225853466, 0.51248735682397895, 0.18066785642320565, 0.044308141549702369, 0.4139266257089867, -0.73717451852305615, -0.49957098114895754, 1.5963751641573409, 0.35409007833879691, 0.23182660684909673, 0.096986389117092175, -0.91577986877742323, 0.46586371787727565, -0.98476504395730713, 0.47639391207439274, -0.46102651616421664, -0.45210645305156022, -2.4862685593293494, -1.443638154138863, -1.0625501716560237, 1.0708380555442683, -1.1201685296190385, -0.89660893532720265]
    for _ in range(10):
        rendering(ind)
    for ind in population:
        rendering(ind)
if __name__=='__main__':
    main()
